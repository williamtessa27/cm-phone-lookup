// examples/usage.js
// Exemple d'utilisation de la librairie CM Phone Lookup V1.5.0

const { 
  detectOperator, 
  isValidNumber, 
  getPhoneInfo, 
  formatPhoneNumber,
  getOperatorPrefixes,
  getSupportedOperators,
  isPrefixForOperator,
  // üÜï NOUVELLES FONCTIONNALIT√âS V1.5.0
  PhoneLookup,
  getCountryMetadata,
  getAllCountries,
  validatePhoneNumber
} = require('../dist/index.js');

console.log("üá®üá≤üá∏üá≥üá®üáÆüá≥üá¨üá¨üá≠ Exemples d'utilisation de CM Phone Lookup V1.5.0 (Multi-pays)\n");

// üÜï NOUVEAU : Exemple 1: API Unifi√©e avec PhoneLookup.analyze()
console.log("üéØ Exemple 1: API Unifi√©e avec PhoneLookup.analyze()");
try {
  const result = PhoneLookup.analyze('+233241234567');
  console.log(`‚úÖ Analyse Ghana r√©ussie:`);
  console.log(`   üìû Num√©ro: ${result.phone}`);
  console.log(`   üè≥Ô∏è Pays: ${result.country?.flag} ${result.country?.name} (${result.country?.nameLocal})`);
  console.log(`   üì± Op√©rateur: ${result.operator}`);
  console.log(`   ‚úÖ Valide: ${result.isValid}`);
  console.log(`   üé® Format√©: ${result.formattedNumber}`);
  console.log(`   üåç Langue: ${Array.isArray(result.country?.language) ? result.country?.language.join(' + ') : result.country?.language}`);
  console.log(`   üí∞ Devise: ${result.country?.currency}`);
  console.log(`   üïê Fuseau: ${result.country?.timezone}`);
  console.log(`   üèõÔ∏è Capitale: ${result.country?.capital}`);
  console.log(`   üë• Population: ${result.country?.population}\n`);
} catch (error) {
  console.log('‚ùå Erreur lors de l\'analyse:', error);
}

// üÜï NOUVEAU : Exemple 2: M√©thodes Chain√©es (Fluent API)
console.log("üîó Exemple 2: M√©thodes Chain√©es (Fluent API)");
try {
  const phoneLookup = new PhoneLookup('+237650123456')
    .validate()
    .format()
    .getInfo();
  
  console.log('‚úÖ M√©thodes chain√©es r√©ussies:');
  console.log(`   üìû Num√©ro: ${phoneLookup.phone}`);
  console.log(`   üè≥Ô∏è Pays: ${phoneLookup.country?.flag} ${phoneLookup.country?.name}`);
  console.log(`   üì± Op√©rateur: ${phoneLookup.operator}\n`);
} catch (error) {
  console.log('‚ùå Erreur avec les m√©thodes chain√©es:', error);
}

// üÜï NOUVEAU : Exemple 3: Configuration Flexible
console.log("‚öôÔ∏è Exemple 3: Configuration Flexible");
try {
  const strictLookup = new PhoneLookup('+233241234567', {
    strictMode: true,
    autoFormat: false,
    language: 'en',
    includeMetadata: true,
    throwOnError: false
  });
  
  const result = strictLookup.analyze();
  console.log('‚úÖ Configuration flexible r√©ussie:');
  console.log(`   üìû Num√©ro: ${result.phone}`);
  console.log(`   üé® Auto-format: ${result.formattedNumber !== result.phone ? 'Activ√©' : 'D√©sactiv√©'}\n`);
} catch (error) {
  console.log('‚ùå Erreur avec la configuration:', error);
}

// üÜï NOUVEAU : Exemple 4: Validation Avanc√©e avec Messages d'Erreur
console.log("üîç Exemple 4: Validation Avanc√©e avec Messages d'Erreur");
try {
  const validation = validatePhoneNumber('123');
  console.log('‚úÖ Validation avec erreurs:');
  console.log(`   üìä Valide: ${validation.isValid}`);
  console.log(`   ‚ùå Erreurs: ${validation.errors.length}`);
  
  validation.errors.forEach((error, index) => {
    console.log(`   ${index + 1}. ${error.code}: ${error.message}`);
    if (error.suggestion) {
      console.log(`      üí° Suggestion: ${error.suggestion}`);
    }
  });
  console.log();
} catch (error) {
  console.log('‚ùå Erreur lors de la validation:', error);
}

// üÜï NOUVEAU : Exemple 5: M√©tadonn√©es des Pays
console.log("üåç Exemple 5: M√©tadonn√©es des Pays");
try {
  const countries = getAllCountries();
  
  console.log('‚úÖ M√©tadonn√©es des pays:');
  countries.forEach(code => {
    const metadata = getCountryMetadata(code);
    if (metadata) {
      console.log(`   ${metadata.flag} ${metadata.name} (${metadata.nameLocal}):`);
      console.log(`      üìç Capitale: ${metadata.capital}`);
      console.log(`      üë• Population: ${metadata.population}`);
      console.log(`      üí∞ Devise: ${metadata.currency}`);
      console.log(`      üïê Fuseau: ${metadata.timezone}`);
      console.log(`      üó£Ô∏è Langue: ${Array.isArray(metadata.language) ? metadata.language.join(' + ') : metadata.language === 'fr' ? 'Fran√ßais' : 'Anglais'}`);
    }
  });
  console.log();
} catch (error) {
  console.log('‚ùå Erreur avec les m√©tadonn√©es:', error);
}

// üÜï NOUVEAU : Exemple 6: Statistiques Globales
console.log("üìä Exemple 6: Statistiques Globales");
try {
  const stats = PhoneLookup.getStats();
  console.log('‚úÖ Statistiques globales:');
  console.log(`   üåç Total pays: ${stats.totalCountries}`);
  console.log(`   üì± Total op√©rateurs: ${stats.totalOperators}`);
  console.log('   üìã D√©tail par pays:');
  
  stats.countries.forEach(country => {
    console.log(`      ${country.flag} ${country.name}: ${country.operators} op√©rateurs`);
  });
  console.log();
} catch (error) {
  console.log('‚ùå Erreur avec les statistiques:', error);
}

// üÜï NOUVEAU : Exemple 7: Gestion d'Erreurs avec throwOnError
console.log("‚ö†Ô∏è Exemple 7: Gestion d'Erreurs avec throwOnError");
try {
  const errorLookup = new PhoneLookup('123', { throwOnError: true });
  errorLookup.validate(); // Ceci devrait lancer une erreur
  console.log('‚ùå Erreur: Aucune exception lev√©e pour un num√©ro invalide');
} catch (error) {
  if (error instanceof Error) {
    console.log('‚úÖ Gestion d\'erreur r√©ussie:');
    console.log(`   üö® Type: ${error.name}`);
    console.log(`   üìù Message: ${error.message}`);
    console.log(`   üî¢ Code: ${error.code}`);
  }
}
console.log();

// üÜï NOUVEAU : Exemple 8: M√©thodes Statiques
console.log("üîß Exemple 8: M√©thodes Statiques");
try {
  console.log('‚úÖ M√©thodes statiques:');
  console.log(`   üì± Op√©rateur: ${PhoneLookup.getOperator('+233241234567')}`);
  console.log(`   ‚úÖ Validation: ${PhoneLookup.validate('+233241234567')}`);
  console.log(`   üé® Formatage: ${PhoneLookup.format('+233241234567')}`);
  console.log();
} catch (error) {
  console.log('‚ùå Erreur avec les m√©thodes statiques:', error);
}

// Exemple 9: D√©tection d'op√©rateur multi-pays (API classique)
console.log("üì± Exemple 9: D√©tection d'op√©rateur multi-pays (API classique)");
const phone1 = "+237650123456";
const operator1 = detectOperator(phone1);
console.log(`Le num√©ro ${phone1} appartient √† l'op√©rateur: ${operator1}`);

const phone1SN = "+221771234567";
const operator1SN = detectOperator(phone1SN);
console.log(`Le num√©ro ${phone1SN} appartient √† l'op√©rateur: ${operator1SN}`);

const phone1CI = "+22501234567";
const operator1CI = detectOperator(phone1CI);
console.log(`Le num√©ro ${phone1CI} appartient √† l'op√©rateur: ${operator1CI}`);

const phone1NG = "+2340803123456";
const operator1NG = detectOperator(phone1NG);
console.log(`Le num√©ro ${phone1NG} appartient √† l'op√©rateur: ${operator1NG}`);

const phone1GH = "+233241234567";
const operator1GH = detectOperator(phone1GH);
console.log(`Le num√©ro ${phone1GH} appartient √† l'op√©rateur: ${operator1GH}\n`);

// Exemple 10: Validation de num√©ro multi-pays (API classique)
console.log("‚úÖ Exemple 10: Validation de num√©ro multi-pays (API classique)");
const phone2 = "237655123456";
const isValid2 = isValidNumber(phone2);
console.log(`Le num√©ro ${phone2} est ${isValid2 ? 'valide' : 'invalide'}`);

const phone2SN = "221771234567";
const isValid2SN = isValidNumber(phone2SN);
console.log(`Le num√©ro ${phone2SN} est ${isValid2SN ? 'valide' : 'invalide'}`);

const phone2CI = "22501234567";
const isValid2CI = isValidNumber(phone2CI);
console.log(`Le num√©ro ${phone2CI} est ${isValid2CI ? 'valide' : 'invalide'}`);

const phone2NG = "2340803123456";
const isValid2NG = isValidNumber(phone2NG);
console.log(`Le num√©ro ${phone2NG} est ${isValid2NG ? 'valide' : 'invalide'}`);

const phone2GH = "233241234567";
const isValid2GH = isValidNumber(phone2GH);
console.log(`Le num√©ro ${phone2GH} est ${isValid2GH ? 'valide' : 'invalide'}\n`);

// Exemple 11: Information compl√®te (API classique)
console.log("üìä Exemple 11: Information compl√®te (API classique)");
const phone3 = "+23722212345";
const info3 = getPhoneInfo(phone3);
console.log(`Informations sur ${phone3}:`);
console.log(JSON.stringify(info3, null, 2));
console.log();

// Exemple 12: Formatage de num√©ro (API classique)
console.log("üé® Exemple 12: Formatage de num√©ro (API classique)");
const phone4 = "237680123456";
const formatted4 = formatPhoneNumber(phone4);
console.log(`Num√©ro original: ${phone4}`);
console.log(`Num√©ro format√©: ${formatted4}\n`);

// Exemple 13: Obtenir les pr√©fixes d'un op√©rateur
console.log("üîç Exemple 13: Pr√©fixes d'op√©rateur");
const mtnPrefixes = getOperatorPrefixes('CAMEROON_MTN');
console.log(`Pr√©fixes CAMEROON_MTN: ${mtnPrefixes.join(', ')}\n`);

// Exemple 14: V√©rifier si un pr√©fixe appartient √† un op√©rateur
console.log("üîç Exemple 14: V√©rification de pr√©fixe");
const prefix = "650";
const isMtn = isPrefixForOperator(prefix, 'CAMEROON_MTN');
console.log(`Le pr√©fixe ${prefix} ${isMtn ? 'appartient' : "n'appartient pas"} √† CAMEROON_MTN\n`);

// Exemple 15: Liste des op√©rateurs support√©s
console.log("üìã Exemple 15: Op√©rateurs support√©s");
const operators = getSupportedOperators();
console.log(`Op√©rateurs support√©s: ${operators.join(', ')}\n`);

// Exemple 16: Traitement en lot multi-pays
console.log("üîÑ Exemple 16: Traitement en lot multi-pays");
const phoneNumbers = [
  "+237650123456",  // CAMEROON_MTN
  "237655123456",   // CAMEROON_ORANGE
  "+23722212345",   // CAMEROON_CAMTEL
  "23766123456",    // CAMEROON_NEXTTEL
  "+221771234567",  // SENEGAL_ORANGE
  "221751234567",   // SENEGAL_EXPRESSO
  "+22501234567",   // IVORY_COAST_ORANGE
  "22527212345",    // IVORY_COAST_TELECOM
  "+2340803123456", // NIGERIA_MTN
  "2340802123456",  // NIGERIA_AIRTEL
  "+233241234567",  // GHANA_MTN
  "233201234567"    // GHANA_VODAFONE
];

console.log("Analyse de plusieurs num√©ros:");
phoneNumbers.forEach(phone => {
  const info = getPhoneInfo(phone);
  console.log(`${phone} ‚Üí ${info.operator} (${info.isValid ? 'Valide' : 'Invalide'})`);
});

console.log("\nüéâ Tous les exemples V1.5.0 sont termin√©s !");
console.log("üöÄ Votre librairie est maintenant beaucoup plus professionnelle et facile √† utiliser !");
