// src/__tests__/countries.test.ts
// Tests pour les fonctionnalitÃ©s spÃ©cifiques aux pays

import { getCountryMetadata, getAllCountries, getCountryByCode } from '../countries/metadata';

describe('MÃ©tadonnÃ©es des pays', () => {
  describe('getCountryMetadata', () => {
    test('retourne les mÃ©tadonnÃ©es du Cameroun', () => {
      const metadata = getCountryMetadata('237');
      
      expect(metadata).toBeDefined();
      expect(metadata?.name).toBe('Cameroon');
      expect(metadata?.nameLocal).toBe('Cameroun');
      expect(metadata?.flag).toBe('ðŸ‡¨ðŸ‡²');
      expect(metadata?.language).toEqual(['fr', 'en']); // Bilingue
      expect(metadata?.currency).toBe('XAF');
      expect(metadata?.timezone).toBe('UTC+1');
      expect(metadata?.capital).toBe('YaoundÃ©');
      expect(metadata?.population).toBeDefined();
    });

    test('retourne les mÃ©tadonnÃ©es du SÃ©nÃ©gal', () => {
      const metadata = getCountryMetadata('221');
      
      expect(metadata).toBeDefined();
      expect(metadata?.name).toBe('Senegal');
      expect(metadata?.nameLocal).toBe('SÃ©nÃ©gal');
      expect(metadata?.flag).toBe('ðŸ‡¸ðŸ‡³');
      expect(metadata?.language).toBe('fr'); // FranÃ§ais uniquement
      expect(metadata?.currency).toBe('XOF');
      expect(metadata?.timezone).toBe('UTC+0');
      expect(metadata?.capital).toBe('Dakar');
    });

    test('retourne les mÃ©tadonnÃ©es de la CÃ´te d\'Ivoire', () => {
      const metadata = getCountryMetadata('225');
      
      expect(metadata).toBeDefined();
      expect(metadata?.name).toBe('Ivory Coast');
      expect(metadata?.nameLocal).toBe('CÃ´te d\'Ivoire');
      expect(metadata?.flag).toBe('ðŸ‡¨ðŸ‡®');
      expect(metadata?.language).toBe('fr');
      expect(metadata?.currency).toBe('XOF');
      expect(metadata?.capital).toBe('Yamoussoukro');
    });

    test('retourne les mÃ©tadonnÃ©es du Nigeria', () => {
      const metadata = getCountryMetadata('234');
      
      expect(metadata).toBeDefined();
      expect(metadata?.name).toBe('Nigeria');
      expect(metadata?.flag).toBe('ðŸ‡³ðŸ‡¬');
      expect(metadata?.language).toBe('en');
      expect(metadata?.currency).toBe('NGN');
      expect(metadata?.capital).toBe('Abuja');
    });

    test('retourne les mÃ©tadonnÃ©es du Ghana', () => {
      const metadata = getCountryMetadata('233');
      
      expect(metadata).toBeDefined();
      expect(metadata?.name).toBe('Ghana');
      expect(metadata?.flag).toBe('ðŸ‡¬ðŸ‡­');
      expect(metadata?.language).toBe('en');
      expect(metadata?.currency).toBe('GHS');
      expect(metadata?.capital).toBe('Accra');
    });

    test('retourne les mÃ©tadonnÃ©es du Kenya', () => {
      const metadata = getCountryMetadata('254');
      
      expect(metadata).toBeDefined();
      expect(metadata?.name).toBe('Kenya');
      expect(metadata?.flag).toBe('ðŸ‡°ðŸ‡ª');
      expect(metadata?.language).toEqual(['en', 'sw']); // Anglais + Swahili
      expect(metadata?.currency).toBe('KES');
      expect(metadata?.capital).toBe('Nairobi');
    });

    test('retourne les mÃ©tadonnÃ©es de l\'Afrique du Sud', () => {
      const metadata = getCountryMetadata('27');
      
      expect(metadata).toBeDefined();
      expect(metadata?.name).toBe('South Africa');
      expect(metadata?.nameLocal).toBe('Suid-Afrika');
      expect(metadata?.flag).toBe('ðŸ‡¿ðŸ‡¦');
      expect(metadata?.language).toEqual(['en', 'af', 'zu']); // Anglais, Afrikaans, Zulu
      expect(metadata?.currency).toBe('ZAR');
      expect(metadata?.capital).toBe('Pretoria');
    });

    test('retourne les mÃ©tadonnÃ©es du Maroc', () => {
      const metadata = getCountryMetadata('212');
      
      expect(metadata).toBeDefined();
      expect(metadata?.name).toBe('Morocco');
      expect(metadata?.nameLocal).toBe('Ø§Ù„Ù…ØºØ±Ø¨');
      expect(metadata?.flag).toBe('ðŸ‡²ðŸ‡¦');
      expect(metadata?.language).toEqual(['ar', 'fr']); // Arabe + FranÃ§ais
      expect(metadata?.currency).toBe('MAD');
      expect(metadata?.capital).toBe('Rabat');
    });

    test('retourne les mÃ©tadonnÃ©es de l\'Ã‰thiopie', () => {
      const metadata = getCountryMetadata('251');
      
      expect(metadata).toBeDefined();
      expect(metadata?.name).toBe('Ethiopia');
      expect(metadata?.nameLocal).toBe('áŠ¢á‰µá‹®áŒµá‹«');
      expect(metadata?.flag).toBe('ðŸ‡ªðŸ‡¹');
      expect(metadata?.language).toEqual(['am', 'en']); // Amharique + Anglais
      expect(metadata?.currency).toBe('ETB');
      expect(metadata?.timezone).toBe('UTC+3');
      expect(metadata?.capital).toBe('Addis Ababa');
      expect(metadata?.population).toBe('120.3M');
    });

    test('retourne les mÃ©tadonnÃ©es de l\'Ã‰gypte', () => {
      const metadata = getCountryMetadata('20');
      
      expect(metadata).toBeDefined();
      expect(metadata?.name).toBe('Egypt');
      expect(metadata?.nameLocal).toBe('Ù…ØµØ±');
      expect(metadata?.flag).toBe('ðŸ‡ªðŸ‡¬');
      expect(metadata?.language).toEqual(['ar', 'en']); // Arabe + Anglais
      expect(metadata?.currency).toBe('EGP');
      expect(metadata?.timezone).toBe('UTC+2');
      expect(metadata?.capital).toBe('Cairo');
      expect(metadata?.population).toBe('104.3M');
    });

    test('retourne null pour un code pays non supportÃ©', () => {
      const metadata = getCountryMetadata('999');
      expect(metadata).toBeNull();
    });

    test('gÃ¨re les codes avec +', () => {
      const metadata = getCountryMetadata('237'); // La fonction n'accepte que les codes sans +
      expect(metadata).toBeDefined();
      expect(metadata?.name).toBe('Cameroon');
    });
  });

  describe('getAllCountries', () => {
    test('retourne tous les codes pays supportÃ©s', () => {
      const countries = getAllCountries();
      
      expect(countries).toContain('237'); // Cameroun
      expect(countries).toContain('221'); // SÃ©nÃ©gal
      expect(countries).toContain('225'); // CÃ´te d'Ivoire
      expect(countries).toContain('234'); // Nigeria
      expect(countries).toContain('233'); // Ghana
      expect(countries).toContain('254'); // Kenya
      expect(countries).toContain('27');  // Afrique du Sud
      expect(countries).toContain('212'); // Maroc
      expect(countries).toContain('251'); // Ã‰thiopie
      expect(countries).toContain('20');  // Ã‰gypte
      expect(countries).toHaveLength(10);
    });

    test('retourne les codes dans un ordre cohÃ©rent', () => {
      const countries1 = getAllCountries();
      const countries2 = getAllCountries();
      
      expect(countries1).toEqual(countries2);
    });
  });

  describe('getCountryByCode', () => {
    test('trouve un pays par son code', () => {
      const cameroon = getCountryByCode('237');
      expect(cameroon?.name).toBe('Cameroon');
      
      const senegal = getCountryByCode('221');
      expect(senegal?.name).toBe('Senegal');
    });

    test('retourne null pour un code inexistant', () => {
      const unknown = getCountryByCode('999');
      expect(unknown).toBeNull();
    });

    test('gÃ¨re les codes avec +', () => {
      const cameroon = getCountryByCode('237'); // La fonction n'accepte que les codes sans +
      expect(cameroon?.name).toBe('Cameroon');
    });
  });

  describe('SpÃ©cificitÃ©s linguistiques', () => {
    test('le Cameroun est le seul pays bilingue', () => {
      const countries = getAllCountries();
      
      const bilingualCountries = countries.filter(code => {
        const metadata = getCountryMetadata(code);
        return Array.isArray(metadata?.language);
      });
      
      expect(bilingualCountries).toHaveLength(6); // Cameroun, Kenya, Afrique du Sud, Maroc, Ã‰thiopie, Ã‰gypte
      expect(bilingualCountries).toContain('237'); // Cameroun
      
      const cameroon = getCountryMetadata('237');
      expect(cameroon?.language).toEqual(['fr', 'en']);
    });

    test('les autres pays ont une seule langue', () => {
      const countries = getAllCountries().filter(code => code !== '237');
      
      const monolingualCountries = countries.filter(code => {
        const metadata = getCountryMetadata(code);
        return typeof metadata?.language === 'string';
      });
      expect(monolingualCountries.length).toBeGreaterThan(0);
    });

    test('distribution des langues', () => {
      const languages = getAllCountries().map(code => {
        const metadata = getCountryMetadata(code);
        return metadata?.language;
      });
      
      // FranÃ§ais : Cameroun (bilingue), SÃ©nÃ©gal, CÃ´te d'Ivoire
      const frenchCountries = languages.filter(lang => 
        lang === 'fr' || (Array.isArray(lang) && lang.includes('fr'))
      ).length;
      expect(frenchCountries).toBe(4); // Cameroun, SÃ©nÃ©gal, CÃ´te d'Ivoire, Maroc
      
      // Anglais : Cameroun (bilingue), Nigeria, Ghana, Kenya, Afrique du Sud
      const englishCountries = languages.filter(lang => 
        lang === 'en' || (Array.isArray(lang) && lang.includes('en'))
      ).length;
      expect(englishCountries).toBe(7); // Cameroun, Nigeria, Ghana, Kenya, Afrique du Sud, Ã‰thiopie, Ã‰gypte
      
      // Arabe : Maroc, Ã‰gypte
      const arabicCountries = languages.filter(lang => 
        lang === 'ar' || (Array.isArray(lang) && lang.includes('ar'))
      ).length;
      expect(arabicCountries).toBe(2);
    });
  });

  describe('CohÃ©rence des donnÃ©es', () => {
    test('tous les pays ont les champs obligatoires', () => {
      const countries = getAllCountries();
      
      countries.forEach(code => {
        const metadata = getCountryMetadata(code);
        
        expect(metadata).toBeDefined();
        expect(metadata?.name).toBeDefined();
        expect(metadata?.nameLocal).toBeDefined();
        expect(metadata?.flag).toBeDefined();
        expect(metadata?.language).toBeDefined();
        expect(metadata?.currency).toBeDefined();
        expect(metadata?.timezone).toBeDefined();
        expect(metadata?.capital).toBeDefined();
        
        // VÃ©rifications de format
        expect(metadata?.name).toMatch(/^[A-Za-z\s]+$/);
        expect(metadata?.flag).toMatch(/^ðŸ‡¨ðŸ‡²|ðŸ‡¸ðŸ‡³|ðŸ‡¨ðŸ‡®|ðŸ‡³ðŸ‡¬|ðŸ‡¬ðŸ‡­|ðŸ‡°ðŸ‡ª|ðŸ‡¿ðŸ‡¦|ðŸ‡²ðŸ‡¦|ðŸ‡ªðŸ‡¹|ðŸ‡ªðŸ‡¬$/); // Drapeaux des pays supportÃ©s
        expect(metadata?.currency).toMatch(/^[A-Z]{3}$/); // Code ISO 4217
      });
    });

    test('les drapeaux correspondent aux pays', () => {
      const expectedFlags = {
        '237': 'ðŸ‡¨ðŸ‡²', // Cameroun
        '221': 'ðŸ‡¸ðŸ‡³', // SÃ©nÃ©gal
        '225': 'ðŸ‡¨ðŸ‡®', // CÃ´te d'Ivoire
        '234': 'ðŸ‡³ðŸ‡¬', // Nigeria
        '233': 'ðŸ‡¬ðŸ‡­', // Ghana
        '254': 'ðŸ‡°ðŸ‡ª', // Kenya
        '27': 'ðŸ‡¿ðŸ‡¦',  // Afrique du Sud
        '212': 'ðŸ‡²ðŸ‡¦'  // Maroc
      };
      
      Object.entries(expectedFlags).forEach(([code, expectedFlag]) => {
        const metadata = getCountryMetadata(code);
        expect(metadata?.flag).toBe(expectedFlag);
      });
    });

    test('les devises sont cohÃ©rentes par rÃ©gion', () => {
      // Zone CFA Ouest (XOF)
      expect(getCountryMetadata('221')?.currency).toBe('XOF'); // SÃ©nÃ©gal
      expect(getCountryMetadata('225')?.currency).toBe('XOF'); // CÃ´te d'Ivoire
      
      // Zone CFA Centre (XAF)
      expect(getCountryMetadata('237')?.currency).toBe('XAF'); // Cameroun
      
      // Autres devises
      expect(getCountryMetadata('234')?.currency).toBe('NGN'); // Nigeria
      expect(getCountryMetadata('233')?.currency).toBe('GHS'); // Ghana
      expect(getCountryMetadata('254')?.currency).toBe('KES'); // Kenya
      expect(getCountryMetadata('27')?.currency).toBe('ZAR');  // Afrique du Sud
      expect(getCountryMetadata('212')?.currency).toBe('MAD'); // Maroc
    });
  });
});
